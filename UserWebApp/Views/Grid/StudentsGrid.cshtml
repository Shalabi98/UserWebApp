@using Kendo.Mvc.UI
@using UserWebApp.ViewModels

@{
    Layout = "_Layout";
}
<style>
    .male-row {
        background-color: deepskyblue;
    }
    .female-row {
        background-color: hotpink;
    }
</style>
@(
    Html.Kendo().Grid<StudentViewModel>()
    .Name("Grid")
    .Columns(columns => {
        columns.Bound(o => o.StudentId);
        columns.Bound(o => o.Username);
        columns.Bound(o => o.FirstName);
        columns.Bound(o => o.LastName);
        columns.Bound(o => o.EnrollmentDate);
        columns.Bound(o => o.Gender).ClientTemplate("#=changeColor(Gender)#");
        columns.Bound(o => o.DateOfBirth);
        columns.Bound(o => o.Email);
        columns.Bound(o => o.MobilePhoneNo);
        columns.Bound(o => o.City);
        columns.Bound(o => o.Address);
        columns.Bound(o => o.IsGraduating);
    })
    .ToolBar(tools => tools.Excel())
    .ToolBar(tools => tools.Pdf())
        .Pdf(pdf => pdf
            .AllPages()
            .AvoidLinks()
            .PaperSize("A2")
            .Scale(0.8)
            .Margin("2cm", "1cm", "1cm", "1cm")
            .Landscape()
            .RepeatHeaders()
            .FileName("StudentDetails.pdf")
            .ProxyURL(Url.Action("Pdf_Export_Save", "Grid"))
    )
    .HtmlAttributes(new { style = "height: 600px" })
    .Sortable()
    .Filterable()
    .Pageable()
    .Scrollable()
    .Excel(excel => excel
        .FileName("StudentDetails.xlsx")
        .Filterable(true)
        .ProxyURL(Url.Action("Excel_Export_Save", "Grid"))
    )
    .AutoBind(true)
    .Events(events => events.DataBound("autoFitColumn"))
    .DataSource(dataSource => dataSource.Ajax()
        .Read(read => read.Action("GetAllStudents", "Grid"))
        .Events(e => e.RequestEnd("requestEnd"))
        .PageSize(5)
    )
    .Resizable(resize => resize.Columns(true))
)

<script>
    function error_handler(e) {
        if (e.errors) {
            var message = "Errors:\n";
            $.each(e.errors, function (key, value) {
                if ('errors' in value) {
                    $.each(value.errors, function () {
                        message += this + "\n";
                    });
                }
            });
            alert(message);
        }
    } 

    function requestEnd(e) {
        console.log(e)
    }

    function autoFitColumn(e) {
        var grid = e.sender;
        for (var i = 0; i < grid.columns.length; i++) {
            grid.autoFitColumn(i);
        }
    }

    function changeColor(g)
    {
        if (g === 'Male') {
            return "<font style='color: deepskyblue'>" + g + "</font>"
        }
        return "<font style='color: hotpink'>" + g+ "</font>"
    }

</script>